!function(c,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):c.SMValidator=a()}(this,function(){"use strict";function e(a,d,b){o?a.attachEvent("on"+d,b):a.addEventListener(d,b)}function p(b){return"checkbox"===b||"radio"===b}function l(b){return"string"==typeof b}function j(c,a){return f.call(c,a)}function h(f,g){var c=this;g||(g={});for(var d,e=v.length-1;0<=e;e--)d=v[e],c[d]=j(g,d)?g[d]:y[d];if(c.fields={},c.rules=g.rules||{},f){for(var a in c.submit=g.submit,g.fields)c.fields[a]=c.parseField(g.fields[a]);c.queryInput(f)}}function r(a,b){if(a)for(var j=a.length-1;0<=j;j--){for(var d=a[j],i=d.target,e=d.className.split(" "),f=i.className?i.className.split(" "):[],g=e.length-1;0<=g;g--){var h=e[g],k=f.indexOf(h);!b&&-1<k?f.splice(k,1):b&&-1===k&&f.push(h)}i.className=f.join(" ")}}function s(e,f,a){if(e)for(var b,c=e.length-1;0<=c;c--)b=e[c],b.keep?f||b.quiet||(b.dom.innerHTML=""):b.dom.style.display=f?"":"none",a&&!b.quiet&&(b.dom.innerHTML=a)}function t(c,d){if(d)for(var a in d)c.style[a]=d[a]}function u(c){var b=c._sm;t(c,b.style),s(b.failHtml,!1),s(b.passHtml,!1),r(b.failCss,!1),r(b.passCss,!1)}function k(e,d){var a=e.type,c=e.name,f=e._sm,i=f.rule,h=!0,b=[],g=1,j="",o="|"===i.token;if(p(a)&&e.form)for(var l=e.form.elements[c],m=l.length-1;0<=m;m--)l[m].checked&&(j+=" ");else if("select-multiple"===a)for(var l=e.children,m=l.length-1;0<=m;m--)l[m].selected&&l[m].value&&(j+=" ");else j=e.value;if(d&&"number"==typeof d.forceFlag)g=d.forceFlag,i.async&&(f.asyncFlag=g,d.asyncMessage&&(f.asyncMessage=d.asyncMessage),2===g&&(h=f.asyncMessage||"no asyncMessage!"));else if(i.async)i.required&&!j?(g=2,h=i.required):"number"==typeof f.asyncFlag?(g=f.asyncFlag,2===g&&(h=f.asyncMessage||"no asyncMessage!")):j?(g=2,h=i.async):g=0;else if(j)for(var m=i.rules.length-1;0<=m;m--){var v=i.rules[m],w=v.rule;if(w instanceof RegExp){if(!w.test(j)){if(h=v.message,g=2,o)break;b.push(h)}}else if(h=v.params?w.apply(null,[j].concat(v.params)):w.call(null,j),!0!==h){if(g=2,o)break;b.push(h)}}else i.required?(g=2,h=i.required,o||b.push(h)):g=0;return o||(g=b.length?2:1),u(e),1===g?(r(f.failCss,!1),r(f.passCss,!0),t(e,i.passStyle),s(f.passHtml,!0),i.pass&&i.pass.call(e)):2==g&&(r(f.passCss,!1),r(f.failCss,!0),t(e,i.failStyle),s(f.failHtml,!0,o?h:b.join("<br/>")),i.fail&&i.fail.call(e,o?h:b)),2===g&&x&&(e.scrollIntoView(),x=!1),h}function m(a,b){for(var c=0;c<b.length;c++)a=a.replace("{"+c+"}",b[c]);return a}var n=window.document,o=!n.addEventListener;if(o)Array.prototype.indexOf=function(d){for(var a=0,b=this.length;a<b;a++)if(this[a]===d)return a;return-1},Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var b=this.nextSibling;b&&1!==b.nodeType;)b=b.nextSibling;return b}});else{var q=!0;n.addEventListener("compositionstart",function(b){q=!1}),n.addEventListener("compositionend",function(b){q=!0;var c=n.createEvent("HTMLEvents");c.initEvent("input",!0,!0),b.target.dispatchEvent(c)}),n.addEventListener("input",function(b){if(q){var c=b.target;c._sm&&!c._sm.rule.disinput&&k(c)}})}e(n,"change",function(c){var a=c.target;p(a.type)&&a._sm&&!a._sm.rule.manul&&k(a)});var f=Object.prototype.hasOwnProperty,v=["required","async","short","disinput","disblur","focus","manul","failHtml","passHtml","failStyle","failCss","passStyle","passCss"],d=v.slice(3),b=h.prototype;b.queryInput=function(i){for(var j=this,k=[],a=n.querySelectorAll(i),d=a.length-1;0<=d;d--){var b=a[d],c=b.tagName;if("FORM"===c){b.novalidate="novalidate";for(var l=[],f=b.length-1;0<=f;f--)j.bindInput(b[f])&&l.push(b[f]);k=k.concat(l),j.submit&&l.length&&(b._smInputs=l,e(b,"submit",function(b){b.preventDefault();var c=b.target||b.srcElement,d=h.validate(c._smInputs,{locate:!0,short:j.short});j.submit(d,c)}))}else"INPUT"!==c&&"SELECT"!==c&&"TEXTAREA"!==c||j.bindInput(b)&&k.push(b)}return k},b.bindInput=function(b){if(b._sm)return!0;var a=this,c=b.getAttribute("name"),m=b.getAttribute("data-rule"),f=m?this.parseString(m):this.fields[c];if(f){if(b._sm={rule:f,flag:0},!f._isInit){f._isInit=!0,a.handleProperty(f,"required"),a.handleProperty(f,"async"),f.async&&(f.manul=!0);for(var q,h=d.length-1;0<=h;h--)q=d[h],j(f,q)||(f[q]=this[q]);a.handleStyle(f,"failStyle"),a.handleStyle(f,"passStyle")}a.recordStyle(b,f.failStyle),a.recordStyle(b,f.passStyle);var i=b._sm;if(p(b.type)){for(var r=n.querySelectorAll("input[name=\""+c+"\"]"),h=r.length-1;0<=h;h--)r[h]!==b&&(r[h]._sm=i);f.disblur=f.disinput=!0,f.focus=!1}else b.style.borderImage||(i.style||(i.style={}),i.style.borderImage="");return a.handleHtml(b,"failHtml",f),a.handleHtml(b,"passHtml",f),a.handleCss(b,"failCss",f.failCss),a.handleCss(b,"passCss",f.passCss),f.manul&&(f.disblur=f.disinput=!0),f.focus&&e(b,"focus",function(b){u(b.target||b.srcElement)}),f.disblur||e(b,"blur",function(b){k(b.target||b.srcElement)}),o&&!f.disinput&&b.attachEvent("onpropertychange",function(b){"value"===b.propertyName&&k(b.srcElement)}),!0}return!1},b.handleProperty=function(c,a){j(c,a)?!0===c[a]&&(c[a]=this[a]):c[a]=!1},b.handleStyle=function(c,a){if(l(c[a]))try{c[a]=JSON.parse(c[a].replace(/'/g,"\""))}catch(b){console.error("error json format: "+c[a])}},b.recordStyle=function(c,d){if(d){c._sm.style||(c._sm.style={});var e=c._sm.style;for(var a in d)e[a]||(e[a]=c.style[a])}},b.handleHtml=function(g,a,h){var i=h[a];if(i){g._sm[a]=[],l(i)&&(i=[i]);for(var j=0;j<i.length;j++){var k,f=i[j],b={};if(0===f.indexOf("*")&&(f=f.substring(1),b.keep=!0),0===f.indexOf("!")&&(f=f.substring(1),b.quiet=!0),-1<f.indexOf("<")){for(var c=g;0===f.indexOf("+");)f=f.substring(1),c=c.parentNode;var d=n.createElement("div");d.innerHTML=f,k=d.children[0],c.parentNode.insertBefore(k,c.nextElementSibling)}else k=n.querySelector(f);k&&(b.dom=k,g._sm[a].push(b),b.keep||(k.style.display="none"))}}},b.handleCss=function(a,b,c){if(c){l(c)&&(c=[c]),a._sm[b]=[];for(var d=c.length-1;0<=d;d--){for(var e=c[d],h=a;0===e.indexOf("+");)e=e.substring(1),h=h.parentNode;a._sm[b].push({target:h,className:e})}}},b.parseRule=function(d,b){var e=d.name,a=this.rules[e]||y.rules[e];a&&(a instanceof Array?b.rules.push({rule:a[0],message:a[1]}):b.rules.push({rule:a,params:d.params}))},b.parseStringFunction=function(b){var e={name:b},d=b.indexOf("(");return 0<d&&(e.name=b.substring(0,d),e.params=-1<b.indexOf("{")?b.substring(d+1,b.length-1):b.substring(d+1,b.length-1).split(",")),e},b.parseString=function(f){var a={rules:[]},i=-1<f.indexOf("&")?"&":"|",c=f.split(i);a.token=i;for(var j,k=c.length-1;0<=k;k--)if(j=c[k],j)if(0===j.indexOf("/")){var b=j.substring(1).split("/");2===b.length?a.rules.push({rule:new RegExp(b[0]),message:b[1]}):3===b.length&&a.rules.push({rule:new RegExp(b[0],"i"),message:b[2]})}else{var g=this.parseStringFunction(j),l=g.name,d=!0;if("!"===l.charAt(0)&&(l=l.substring(1),d=!1),-1<v.indexOf(l)){var e=g.params;a[l]=e?e:d}else this.parseRule(g,a)}return a},b.parseField=function(c){if(c instanceof Array)return{rules:[{rule:c[0],message:c[1]}]};if(c instanceof Function)return{rules:[{rule:c}]};if(l(c))return this.parseString(c);if("object"==typeof c){if(c.token="|",c.rule instanceof Array)c.rules=[{rule:c.rule[0],message:c.rule[1]}];else if(c.rule instanceof Function)c.rules=[{rule:c.rule}];else if(l(c.rule)){var f=c.rule;delete c.rule,-1<f.indexOf("&")&&(c.token="&");var b=f.split(c.token);c.rules=[];for(var e=b.length-1;0<=e;e--)b[e]&&this.parseRule(this.parseStringFunction(b[e]),c)}return c}};var w,x,y={async:"not been validated by async",required:"this is required",rules:{}};h.config=function(e){for(var a,b=v.length-1;0<=b;b--)a=v[b],j(e,a)&&(y[a]=e[a]);if(e.rules)for(var c in e.rules)y.rules[c]=e.rules[c];w=new h},h.validate=function(i,b){var c=l(i)?w.queryInput(i):i,d=0,e=0,f=!1;b&&(x=b.locate,f=b.short);for(var a,g=c.length-1;0<=g;g--)if(a=c[g],a._sm)if(e++,!0===k(a,b))d++;else if(f)return!1;return e==d},h.reset=function(d){for(var a=l(d)?w.queryInput(d):d,b=a.length-1;0<=b;b--)u(a[b])};var i={number:"请填写数字",names:"wrong name format",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",renge_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};h.config({failHtml:"<span style=\"color:#c00;\"></span>",failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:function(b){return /^-?\d+(\.{1}\d+)?$/.test(b)||i.number},names:function(b){return /^(\w+[\-']?\w+\s?)+$/i.test(b)||i.names},email:function(b){return /^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i.test(b)||i.email},range:function(e,b,c){e*=1;var d=/^-?\d+(\.{1}\d+)?$/;return d.test(e)?b&&!d.test(b)&&c&&!d.test(c)?i.error_param:2===arguments.length?e==b||m(i.range_equal,[b]):3===arguments.length?b&&c?e>b&&e<c||m(i.range_scope,[b,c]):b?e>b||m(i.range_greater,[b]):c?e<c||m(i.range_less,[c]):i.error_param:void 0:i.renge_no_number},length:function(e,b,c){var d=e.length;return 2===arguments.length?d==b||m(i.length_equal,[b]):3===arguments.length?b&&c?d>b&&d<c||m(i.length_scope,[b,c]):b?d>b||m(i.length_greater,[b]):c?d<c||m(i.length_less,[c]):i.error_param:void 0},equal:function(d,a){var b=n.querySelector(a);return d===b.value||i.password}}}),h.setLang=function(c){for(var a in c)i[a]=c[a]};var g={bootstrap:{failStyle:!1,failHtml:["!<span class=\"glyphicon glyphicon-remove form-control-feedback\"></span>","<small class=\"help-block\"></small>"],failCss:"++has-error has-feedback",passHtml:"<span class=\"glyphicon glyphicon-ok form-control-feedback\"></span>",passCss:"++has-success has-feedback"},semantic:{failStyle:!1,failHtml:["!<i class=\"remove icon\"></i>","+<small class=\"ui red pointing label\"></small>"],failCss:"++error",passHtml:"<i class=\"checkmark icon\"></i>"}};return h.setSkin=function(a){h.config(g[a])},h});